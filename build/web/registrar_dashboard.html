<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Registrar Dashboard</title>
    <style>
        /* === ALL CSS (combined) === */
        * { margin:0; padding:0; box-sizing:border-box; font-family:'Segoe UI',sans-serif; }
        body { background:linear-gradient(135deg,#f5f7fa 0%,#c3cfe2 100%); min-height:100vh; }
        .header { background:linear-gradient(135deg,#2c3e50 0%,#3498db 100%); color:white; padding:20px 40px; display:flex; justify-content:space-between; align-items:center; }
        .header h1 { font-size:24px; font-weight:300; }
        .logout-btn { background:linear-gradient(135deg,#e74c3c 0%,#c0392b 100%); color:white; padding:10px 20px; border:none; border-radius:25px; cursor:pointer; font-size:14px; font-weight:600; transition:all 0.3s; }
        .logout-btn:hover { background:#c0392b; transform:translateY(-2px); }
        .menu { background:rgba(255,255,255,0.95); padding:15px 40px; box-shadow:0 2px 10px rgba(0,0,0,0.05); border-bottom:1px solid rgba(0,0,0,0.08); backdrop-filter:blur(10px); }
        .menu a { margin-right:25px; text-decoration:none; color:#555; padding:10px 20px; border-radius:25px; font-size:15px; font-weight:500; transition:all 0.3s; display:inline-block; }
        .menu a:hover { background:linear-gradient(135deg,#3498db 0%,#2980b9 100%); color:white; transform:translateY(-2px); }
        .menu a.active { background:linear-gradient(135deg,#3498db 0%,#2980b9 100%); color:white; }
        .main-container { max-width:1200px; margin:30px auto; padding:0 40px; }
        .welcome-container { text-align:center; padding:50px 30px; margin-bottom:40px; background:rgba(255,255,255,0.95); border-radius:20px; box-shadow:0 10px 30px rgba(0,0,0,0.15); backdrop-filter:blur(20px); position:relative; overflow:hidden; }
        .welcome-container::before { content:''; position:absolute; top:0; left:0; right:0; height:4px; background:linear-gradient(90deg,#3498db,#2ecc71,#f39c12); }
        .welcome-title { font-size:2.5rem; color:#2c3e50; margin-bottom:15px; font-weight:700; }
        .welcome-subtitle { font-size:1.5rem; color:#2ecc71; margin-bottom:25px; font-weight:600; }
        .welcome-text { font-size:1.1rem; color:#34495e; max-width:800px; margin:0 auto 40px; line-height:1.7; font-weight:500; }
        .school-motto { font-style:italic; color:#2c3e50; margin-top:25px; font-size:1.2rem; background:#f8f9fa; padding:15px 30px; border-radius:30px; display:inline-block; font-weight:600; border:2px solid #e0e7ff; }
        .quick-stats { margin:40px 0; }
        .stats-grid { display:grid; grid-template-columns:repeat(auto-fit, minmax(250px,1fr)); gap:25px; margin-top:30px; }
        .stat-card { background:rgba(255,255,255,0.95); padding:30px; border-radius:20px; box-shadow:0 10px 30px rgba(0,0,0,0.12); text-align:center; border-top:5px solid #2196F3; transition:all 0.3s; backdrop-filter:blur(18px); }
        .stat-card:hover { transform:translateY(-5px); box-shadow:0 14px 35px rgba(33,150,243,0.25); }
        .stat-icon { font-size:40px; margin-bottom:15px; color:#2196F3; }
        .stat-value { font-size:2.5rem; color:#2c3e50; font-weight:700; margin-bottom:10px; }
        .stat-label { color:#7f8c8d; font-size:16px; font-weight:500; }
        .recent-activity { margin:50px 0; }
        .section-title { color:#2c3e50; font-size:1.8rem; margin-bottom:25px; font-weight:700; border-bottom:2px solid #eaeaea; padding-bottom:15px; }
        .activity-list { background:rgba(255,255,255,0.95); border-radius:20px; box-shadow:0 10px 30px rgba(0,0,0,0.12); overflow:hidden; backdrop-filter:blur(18px); }
        .activity-item { padding:20px 30px; border-bottom:1px solid #f0f0f0; display:flex; align-items:center; transition:background 0.3s; }
        .activity-item:hover { background:#f9f9f9; }
        .activity-icon { font-size:24px; margin-right:20px; width:50px; height:50px; background:#f0f5ff; border-radius:50%; display:flex; align-items:center; justify-content:center; color:#2c3e50; }
        .activity-content { flex:1; }
        .activity-title { font-weight:600; color:#2c3e50; margin-bottom:5px; }
        .activity-time { color:#888; font-size:14px; }
        .footer { background:#2c3e50; color:white; padding:30px 40px; margin-top:60px; text-align:center; }
        .footer-links { display:flex; justify-content:center; gap:30px; margin-bottom:20px; flex-wrap:wrap; }
        .footer-links a { color:#e0e7ff; text-decoration:none; font-size:14px; transition:color 0.3s; }
        .footer-links a:hover { color:white; text-decoration:underline; }
        .copyright { color:#a0aec0; font-size:14px; margin-top:20px; padding-top:20px; border-top:1px solid #2d4a7a; }
        @media (max-width:768px) { .header, .menu { text-align:center; } .menu a { margin:5px; padding:8px 15px; } .main-container { padding:0 20px; } .welcome-title { font-size:2rem; } }

        /* ===== REGISTRATION/ENROLLMENT/CERTIFICATES STYLES ===== */
        .action-cards { display:grid; grid-template-columns:repeat(auto-fit, minmax(300px,1fr)); gap:25px; margin:40px 0; }
        .action-card { background:rgba(255,255,255,0.95); padding:30px; border-radius:20px; box-shadow:0 10px 30px rgba(0,0,0,0.12); text-align:center; cursor:pointer; transition:all 0.3s; backdrop-filter:blur(18px); border-top:5px solid #3498db; }
        .action-card:hover { transform:translateY(-5px); box-shadow:0 14px 35px rgba(52,152,219,0.25); }
        .action-card h3 { color:#2c3e50; margin-bottom:15px; font-size:1.4rem; }
        .action-card p { color:#666; margin-bottom:20px; }
        .action-card button { background:#3498db; color:white; border:none; padding:10px 20px; border-radius:25px; cursor:pointer; }
        .form-container, .search-form, .search-results-container, .table-container { background:rgba(255,255,255,0.95); padding:35px; border-radius:20px; box-shadow:0 10px 30px rgba(0,0,0,0.12); margin:30px 0; display:none; backdrop-filter:blur(18px); }
        .form-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:25px; padding-bottom:20px; border-bottom:2px solid #eaeaea; }
        .form-header h3 { color:#2c3e50; font-size:1.5rem; }
        .close-btn { background:#f0f5ff; color:#666; border:none; width:36px; height:36px; border-radius:50%; cursor:pointer; font-size:18px; }
        .form-grid { display:grid; grid-template-columns:repeat(auto-fit, minmax(280px,1fr)); gap:20px; margin-bottom:25px; }
        .form-group { margin-bottom:15px; }
        .form-group label { display:block; margin-bottom:8px; color:#2c3e50; font-weight:500; }
        .form-control { width:100%; padding:12px; border:1px solid #ddd; border-radius:10px; }
        .form-control:focus { outline:none; border-color:#3498db; }
        .btn-group { display:flex; gap:15px; margin-top:25px; padding-top:25px; border-top:2px solid #eaeaea; }
        .btn { padding:12px 25px; border:none; border-radius:10px; cursor:pointer; font-weight:600; transition:all 0.3s; }
        .btn-primary { background:#3498db; color:white; }
        .btn-success { background:#27ae60; color:white; }
        .btn-warning { background:#f39c12; color:white; }
        .btn-secondary { background:#95a5a6; color:white; }
        .search-grid { display:grid; grid-template-columns:repeat(auto-fit, minmax(250px,1fr)); gap:15px; margin-bottom:20px; }
        .data-table { width:100%; border-collapse:collapse; }
        .data-table th { background:#f8f9fa; padding:15px; text-align:left; border-bottom:2px solid #e9ecef; }
        .data-table td { padding:15px; border-bottom:1px solid #e9ecef; }
        .status-badge { padding:5px 12px; border-radius:20px; font-size:12px; display:inline-block; }
        .status-active { background:#d4edda; color:#155724; }
        .loading { text-align:center; padding:40px; color:#3498db; }
        .empty-state { text-align:center; padding:50px 20px; color:#7f8c8d; }
        .hidden-section { display:none; }
        .notification { position:fixed; top:20px; right:20px; padding:15px 25px; border-radius:10px; color:white; z-index:1000; display:none; animation:slideIn 0.3s ease; }
        .notification.success { background:linear-gradient(135deg,#2ecc71,#27ae60); }
        .notification.error { background:linear-gradient(135deg,#e74c3c,#c0392b); }
        @keyframes slideIn { from { transform:translateX(100%); opacity:0; } to { transform:translateX(0); opacity:1; } }

        /* Certificate search section */
        .certificate-search-section {
            background: rgba(255,255,255,0.95);
            border-radius: 20px;
            padding: 25px;
            margin: 30px 0;
            box-shadow: 0 10px 30px rgba(0,0,0,0.12);
            backdrop-filter: blur(18px);
            display: none;
        }
        .certificate-search-section.active {
            display: block;
        }
        .certificate-type-indicator {
            display: inline-block;
            padding: 5px 15px;
            background: #3498db;
            color: white;
            border-radius: 20px;
            margin-bottom: 15px;
        }
        .student-results-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        .student-results-table th {
            background: #3498db;
            color: white;
            padding: 10px;
            text-align: left;
        }
        .student-results-table td {
            padding: 10px;
            border-bottom: 1px solid #ddd;
        }
        .generate-btn {
            background: #27ae60;
            color: white;
            border: none;
            padding: 5px 15px;
            border-radius: 5px;
            cursor: pointer;
        }
        .generate-btn:hover {
            background: #219653;
        }
    </style>
</head>
<body>
    <!-- Notification -->
    <div id="notification" class="notification"></div>

    <!-- Header -->
    <div class="header">
        <h1>Registrar Dashboard</h1>
        <div>
            <span style="margin-right:20px;">Welcome, Registrar!</span>
            <button class="logout-btn" onclick="location.href='logout'">Logout</button>
        </div>
    </div>

    <!-- Menu (Student Records link removed) -->
    <div class="menu">
        <a href="#dashboard" class="active" onclick="showSection('dashboard')">üè† Dashboard</a>
        <a href="#registration" onclick="showSection('registration')">üìù Student Registration</a>
        <a href="#enrollment" onclick="showSection('enrollment')">üìö Enrollment</a>
        <a href="#certificates" onclick="showSection('certificates')">üìÑ Certificates</a>
    </div>

    <!-- Main Content -->
    <div class="main-container">
        <!-- DASHBOARD SECTION -->
        <div id="section-dashboard" class="section">
            <div class="welcome-container">
                <h1 class="welcome-title">Welcome to Registrar Portal</h1>
                <h2 class="welcome-subtitle">Bense Secondary High School</h2>
                <p class="welcome-text">Manage student registrations, track academic records, and oversee administrative tasks.</p>
                <p class="school-motto">"Managing Excellence, Building Futures"</p>
            </div>
            <div class="quick-stats">
                <h2 class="section-title">Academic Overview</h2>
                <div class="stats-grid">
                    <div class="stat-card"><div class="stat-icon">üë®‚Äçüéì</div><div class="stat-value" id="totalStudents">0</div><div class="stat-label">Total Students</div></div>
                    <div class="stat-card"><div class="stat-icon">üìà</div><div class="stat-value" id="newAdmissions">0</div><div class="stat-label">New Admissions</div></div>
                    <div class="stat-card"><div class="stat-icon">üìã</div><div class="stat-value" id="pendingRequests">0</div><div class="stat-label">Pending Requests</div></div>
                    <div class="stat-card"><div class="stat-icon">üìÖ</div><div class="stat-value" id="todayEnrollments">0</div><div class="stat-label">Today's Enrollments</div></div>
                </div>
            </div>
            <div class="recent-activity">
                <h2 class="section-title">Recent Activity</h2>
                <div class="activity-list">
                    <div class="activity-item"><div class="activity-icon">üë®‚Äçüéì</div><div class="activity-content"><div class="activity-title">New student registered</div><div class="activity-time">Today</div></div></div>
                    <div class="activity-item"><div class="activity-icon">üìù</div><div class="activity-content"><div class="activity-title">5 students promoted</div><div class="activity-time">Yesterday</div></div></div>
                </div>
            </div>
        </div>

        <!-- REGISTRATION SECTION (unchanged) -->
        <div id="section-registration" class="section hidden-section">
            <div class="welcome-container">
                <h1 class="welcome-title">Student Registration Management</h1>
                <p class="welcome-text">Manage student registrations, search existing records, and add new students.</p>
            </div>

            <div class="action-cards" id="actionCards">
                <div class="action-card" onclick="showAddStudentForm()">
                    <h3>Add New Student</h3>
                    <p>Register a new student in the system with personal and guardian information.</p>
                    <button>Add Student</button>
                </div>
                <div class="action-card" onclick="showSearchForm()">
                    <h3>Search Students</h3>
                    <p>Find students by ID, name, or grade level.</p>
                    <button>Search Students</button>
                </div>
                <div class="action-card" onclick="showAllStudents()">
                    <h3>View All Students</h3>
                    <p>Browse complete list of registered students.</p>
                    <button>View All</button>
                </div>
            </div>

            <div class="form-container" id="addStudentForm">
                <div class="form-header">
                    <h3>Add New Student</h3>
                    <button class="close-btn" onclick="hideAllForms()">‚úï</button>
                </div>
                <form id="studentForm" onsubmit="return handleSubmit(event)">
                    <input type="hidden" id="student_id">
                    <div class="form-grid">
                        <div class="form-group"><label>First Name *</label><input type="text" id="first_name" class="form-control" required></div>
                        <div class="form-group"><label>Last Name *</label><input type="text" id="last_name" class="form-control" required></div>
                        <div class="form-group"><label>Date of Birth *</label><input type="date" id="dob" class="form-control" required></div>
                        <div class="form-group"><label>Gender *</label><select id="gender" class="form-control" required><option value="">Select</option><option value="Male">Male</option><option value="Female">Female</option></select></div>
                        <div class="form-group"><label>Grade Level *</label><select id="grade_level" class="form-control" required><option value="">Select</option><option value="9">9</option><option value="10">10</option><option value="11">11</option><option value="12">12</option></select></div>
                        <div class="form-group"><label>Section *</label><input type="text" id="section" class="form-control" required></div>
                        <div class="form-group"><label>Email</label><input type="email" id="email" class="form-control"></div>
                        <div class="form-group"><label>Phone</label><input type="tel" id="phone" class="form-control"></div>
                        <div class="form-group"><label>Address</label><textarea id="address" class="form-control" rows="2"></textarea></div>
                        <div class="form-group"><label>Parent Name</label><input type="text" id="parent_name" class="form-control"></div>
                        <div class="form-group"><label>Parent Phone</label><input type="tel" id="parent_phone" class="form-control"></div>
                        <div class="form-group"><label>Status *</label><select id="registration_status" class="form-control" required><option value="Active">Active</option><option value="Inactive">Inactive</option><option value="Graduated">Graduated</option><option value="Transferred">Transferred</option></select></div>
                    </div>
                    <div class="btn-group">
                        <button type="submit" class="btn btn-success" id="submitBtn">Save Student</button>
                        <button type="button" class="btn btn-warning" onclick="resetForm()">Reset</button>
                        <button type="button" class="btn btn-secondary" onclick="hideAllForms()">Cancel</button>
                    </div>
                </form>
            </div>

            <div class="search-form" id="searchForm">
                <div class="form-header">
                    <h3>Search Students</h3>
                    <button class="close-btn" onclick="hideAllForms()">‚úï</button>
                </div>
                <div class="search-grid">
                    <div class="form-group"><label>Student ID</label><input type="text" id="searchStudentId" class="form-control" placeholder="STU10001"></div>
                    <div class="form-group"><label>First Name</label><input type="text" id="searchFirstName" class="form-control" placeholder="First name"></div>
                    <div class="form-group"><label>Last Name</label><input type="text" id="searchLastName" class="form-control" placeholder="Last name"></div>
                    <div class="form-group"><label>Grade Level</label><select id="searchGradeLevel" class="form-control"><option value="">All</option><option value="9">9</option><option value="10">10</option><option value="11">11</option><option value="12">12</option></select></div>
                </div>
                <div class="btn-group">
                    <button type="button" class="btn btn-primary" onclick="searchStudents()">Search</button>
                    <button type="button" class="btn btn-warning" onclick="resetSearchForm()">Reset</button>
                    <button type="button" class="btn btn-secondary" onclick="hideAllForms()">Cancel</button>
                </div>
            </div>

            <div class="search-results-container" id="searchResults">
                <div class="form-header">
                    <h3>Search Results</h3>
                    <button class="close-btn" onclick="hideSearchResults()">‚úï</button>
                </div>
                <div id="searchLoading" class="loading" style="display:none;">Searching...</div>
                <div id="searchResultsContent">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Name</th>
                                <th>Grade</th>
                                <th>Section</th>
                                <th>Email</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="searchResultsBody">
                            <!-- Results will be inserted here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="table-container" id="studentsTable">
                <div class="form-header">
                    <h3>All Students</h3>
                    <button class="close-btn" onclick="hideAllForms()">‚úï</button>
                </div>
                <div id="tableLoading" class="loading" style="display:none;">Loading students...</div>
                <div id="tableContainer">
                    <table class="data-table">
                        <thead><tr><th>ID</th><th>Name</th><th>Grade</th><th>Section</th><th>Email</th><th>Status</th><th>Actions</th></tr></thead>
                        <tbody id="studentsTableBody"></tbody>
                    </table>
                </div>
                <div id="noResults" class="empty-state" style="display:none;"><h4>No students found</h4></div>
            </div>
        </div>

        <!-- ENROLLMENT SECTION (Search Enrollments card removed) -->
        <div id="section-enrollment" class="section hidden-section">
            <div class="welcome-container">
                <h1 class="welcome-title">Enrollment & Sections Management</h1>
                <p class="welcome-text">Manage student enrollments, promote students to next grades, and assign sections.</p>
            </div>

            <div class="action-cards" id="enrollmentActionCards">
                <div class="action-card" onclick="showAddEnrollmentForm()">
                    <h3>Add Enrollment</h3>
                    <p>Enroll a student for a specific academic year, grade, and section.</p>
                    <button>Add Enrollment</button>
                </div>
                <!-- Search Enrollments card removed -->
                <div class="action-card" onclick="showBatchPromotionForm()">
                    <h3>Batch Promotion</h3>
                    <p>Promote students based on grades (promote if failing subjects < 3).</p>
                    <button>Promote Now</button>
                </div>
                <div class="action-card" onclick="showAllEnrollments()">
                    <h3>View All Enrollments</h3>
                    <p>Browse complete list of enrollments for the current academic year.</p>
                    <button>View All</button>
                </div>
            </div>

            <div class="form-container" id="addEnrollmentForm">
                <div class="form-header">
                    <h3>Add New Enrollment</h3>
                    <button class="close-btn" onclick="hideAllEnrollmentForms()">‚úï</button>
                </div>
                <form id="enrollmentForm" onsubmit="return handleEnrollmentSubmit(event)">
                    <input type="hidden" id="enrollment_id">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Student *</label>
                            <select id="student_id" class="form-control" required>
                                <option value="">Select Student</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Academic Year *</label>
                            <select id="academic_year" class="form-control" required>
                                <option value="">Select Year</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Grade Level *</label>
                            <select id="grade_level" class="form-control" required>
                                <option value="">Select Grade</option>
                                <option value="9">9</option>
                                <option value="10">10</option>
                                <option value="11">11</option>
                                <option value="12">12</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Section *</label>
                            <input type="text" id="section" class="form-control" placeholder="A, B, C" required>
                        </div>
                        <div class="form-group">
                            <label>Enrollment Type *</label>
                            <select id="enrollment_type" class="form-control" required>
                                <option value="">Select Type</option>
                                <option value="New">New</option>
                                <option value="Re-enrollment">Re-enrollment</option>
                                <option value="Transfer">Transfer</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Enrollment Date *</label>
                            <input type="date" id="enrollment_date" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>Status *</label>
                            <select id="status" class="form-control" required>
                                <option value="Active">Active</option>
                                <option value="Pending">Pending</option>
                                <option value="Withdrawn">Withdrawn</option>
                            </select>
                        </div>
                    </div>
                    <div class="btn-group">
                        <button type="submit" class="btn btn-success" id="enrollmentSubmitBtn">Save Enrollment</button>
                        <button type="button" class="btn btn-warning" onclick="resetEnrollmentForm()">Reset</button>
                        <button type="button" class="btn btn-secondary" onclick="hideAllEnrollmentForms()">Cancel</button>
                    </div>
                </form>
            </div>

            <!-- Search Enrollment Form (still present but no card to access it) -->
            <div class="search-form" id="searchEnrollmentForm">
                <div class="form-header">
                    <h3>Search Enrollments</h3>
                    <button class="close-btn" onclick="hideAllEnrollmentForms()">‚úï</button>
                </div>
                <div class="search-grid">
                    <div class="form-group"><label>Student ID</label><input type="text" id="searchEnrollStudentId" class="form-control" placeholder="STU10001"></div>
                    <div class="form-group"><label>Grade Level</label><select id="searchEnrollGrade" class="form-control"><option value="">All</option><option value="9">9</option><option value="10">10</option><option value="11">11</option><option value="12">12</option></select></div>
                    <div class="form-group"><label>Academic Year</label><select id="searchEnrollYear" class="form-control"><option value="">All</option></select></div>
                    <div class="form-group"><label>Status</label><select id="searchEnrollStatus" class="form-control"><option value="">All</option><option value="Active">Active</option><option value="Pending">Pending</option><option value="Withdrawn">Withdrawn</option></select></div>
                </div>
                <div class="btn-group">
                    <button type="button" class="btn btn-primary" onclick="searchEnrollments()">Search</button>
                    <button type="button" class="btn btn-warning" onclick="resetSearchEnrollmentForm()">Reset</button>
                    <button type="button" class="btn btn-secondary" onclick="hideAllEnrollmentForms()">Cancel</button>
                </div>
            </div>

            <div class="form-container" id="batchPromotionForm">
                <div class="form-header">
                    <h3>Batch Promotion</h3>
                    <button class="close-btn" onclick="hideAllEnrollmentForms()">‚úï</button>
                </div>
                <form id="promotionForm" onsubmit="return false;">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>From Grade *</label>
                            <select id="fromGrade" class="form-control" required>
                                <option value="">Select Grade</option>
                                <option value="9">9</option>
                                <option value="10">10</option>
                                <option value="11">11</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>To Grade *</label>
                            <select id="toGrade" class="form-control" required>
                                <option value="">Select Grade</option>
                                <option value="10">10</option>
                                <option value="11">11</option>
                                <option value="12">12</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Academic Year *</label>
                            <select id="promotionYear" class="form-control" required>
                                <option value="">Select Year</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>New Section Pattern</label>
                            <input type="text" id="newSection" class="form-control" placeholder="e.g., A (if same) or leave blank">
                        </div>
                    </div>
                    <div class="btn-group">
                        <button type="button" class="btn btn-primary" onclick="previewPromotion()">Preview Promotion</button>
                        <button type="button" class="btn btn-secondary" onclick="hideAllEnrollmentForms()">Cancel</button>
                    </div>
                </form>

                <div id="promotionPreview" style="margin-top:20px; display:none;">
                    <h4>Promotion Preview</h4>
                    <div id="previewLoading" class="loading" style="display:none;">Loading preview...</div>
                    <div id="previewResults"></div>
                    <div class="btn-group" style="margin-top:15px;">
                        <button type="button" class="btn btn-success" onclick="confirmPromotion()">Confirm Promotion</button>
                        <button type="button" class="btn btn-warning" onclick="resetPromotionPreview()">Back</button>
                    </div>
                </div>
            </div>

            <div class="search-results-container" id="enrollmentSearchResults">
                <div class="form-header">
                    <h3>Search Results</h3>
                    <button class="close-btn" onclick="hideSearchEnrollmentResults()">‚úï</button>
                </div>
                <div id="enrollmentSearchLoading" class="loading" style="display:none;">Searching...</div>
                <div id="enrollmentSearchContent">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Enrollment ID</th>
                                <th>Student ID</th>
                                <th>Name</th>
                                <th>Grade</th>
                                <th>Section</th>
                                <th>Academic Year</th>
                                <th>Type</th>
                                <th>Date</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="enrollmentSearchBody">
                            <!-- Results inserted here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="table-container" id="allEnrollmentsTable">
                <div class="form-header">
                    <h3>All Enrollments</h3>
                    <button class="close-btn" onclick="hideAllEnrollmentForms()">‚úï</button>
                </div>
                <div id="allEnrollmentsLoading" class="loading" style="display:none;">Loading enrollments...</div>
                <div id="allEnrollmentsContainer">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Enrollment ID</th>
                                <th>Student ID</th>
                                <th>Name</th>
                                <th>Grade</th>
                                <th>Section</th>
                                <th>Academic Year</th>
                                <th>Type</th>
                                <th>Date</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="allEnrollmentsBody">
                            <!-- Rows inserted here -->
                        </tbody>
                    </table>
                </div>
                <div id="noEnrollments" class="empty-state" style="display:none;"><h4>No enrollments found</h4></div>
            </div>
        </div>

        <!-- CERTIFICATES SECTION (unchanged) -->
        <div id="section-certificates" class="section hidden-section">
            <div class="welcome-container">
                <h1 class="welcome-title">Certificates & Reports Generation</h1>
                <p class="welcome-text">Generate official documents, certificates, and academic reports.</p>
            </div>

            <!-- Action Cards -->
            <div class="action-cards" id="certificateActionCards">
                <div class="action-card" onclick="showCertificateSearch('enrollment')">
                    <h3>Enrollment Certificates</h3>
                    <p>Generate certificates for current students.</p>
                    <button>Select</button>
                </div>
                <div class="action-card" onclick="showCertificateSearch('completion')">
                    <h3>Completion Certificates</h3>
                    <p>Generate certificates for graduating students.</p>
                    <button>Select</button>
                </div>
                <div class="action-card" onclick="showCertificateSearch('transcript')">
                    <h3>Academic Transcripts</h3>
                    <p>Compile transcripts from grades and subjects data.</p>
                    <button>Select</button>
                </div>
                

            <!-- Certificate Search Section (appears below cards) -->
            <div class="certificate-search-section" id="certificateSearchSection">
                <div class="certificate-type-indicator" id="selectedCertTypeDisplay">Enrollment Certificate</div>
                <h3>Search Student</h3>
                <div class="search-grid">
                    <div class="form-group">
                        <label>Student ID</label>
                        <input type="text" id="certSearchStudentId" class="form-control" placeholder="STU10001">
                    </div>
                    <div class="form-group">
                        <label>First Name</label>
                        <input type="text" id="certSearchFirstName" class="form-control" placeholder="First name">
                    </div>
                    <div class="form-group">
                        <label>Last Name</label>
                        <input type="text" id="certSearchLastName" class="form-control" placeholder="Last name">
                    </div>
                    <div class="form-group">
                        <label>Grade Level</label>
                        <select id="certSearchGradeLevel" class="form-control">
                            <option value="">All</option>
                            <option value="9">9</option>
                            <option value="10">10</option>
                            <option value="11">11</option>
                            <option value="12">12</option>
                        </select>
                    </div>
                </div>
                <div class="btn-group">
                    <button type="button" class="btn btn-primary" onclick="searchCertificateStudents()">Search</button>
                    <button type="button" class="btn btn-warning" onclick="resetCertificateSearch()">Reset</button>
                    <button type="button" class="btn btn-secondary" onclick="hideCertificateSearch()">Cancel</button>
                </div>

                <!-- Results Table -->
                <div id="certStudentResults" style="margin-top:20px;">
                    <!-- Results will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Footer (Records link removed) -->
    <div class="footer">
        <div class="footer-content">
            <div class="footer-links">
                <a href="#dashboard" onclick="showSection('dashboard')">Home</a>
                <a href="#registration" onclick="showSection('registration')">Registration</a>
                <a href="#enrollment" onclick="showSection('enrollment')">Enrollment</a>
                <a href="#certificates" onclick="showSection('certificates')">Certificates</a>
            </div>
            <div class="copyright">¬© 2024 Bense Secondary High School - Registrar Portal</div>
        </div>
    </div>

    <script>
        // ========== Global State ==========
        let currentAction = 'add'; // for students
        let currentView = 'cards'; // for students
        let enrollmentCurrentAction = 'add'; // for enrollments
        let enrollmentCurrentView = 'cards'; // for enrollments
        let currentCertType = ''; // for certificates

        // ========== Notification ==========
        function showNotification(message, type='success') {
            const n = document.getElementById('notification');
            n.textContent = message;
            n.className = `notification ${type}`;
            n.style.display = 'block';
            setTimeout(() => n.style.display = 'none', 3000);
        }

        // ========== Section Navigation ==========
        function showSection(section) {
            document.querySelectorAll('.section').forEach(sec => sec.style.display = 'none');
            document.getElementById('section-' + section).style.display = 'block';
            document.querySelectorAll('.menu a').forEach(a => a.classList.remove('active'));
            const activeLink = Array.from(document.querySelectorAll('.menu a')).find(a => a.getAttribute('href') === '#' + section);
            if (activeLink) activeLink.classList.add('active');
            if (section === 'dashboard') updateDashboardCounts();
            if (section === 'enrollment') {
                loadAcademicYears();
                loadStudentsForDropdown();
            }
            if (section === 'certificates') {
                hideCertificateSearch(); // ensure search section is hidden when switching to certificates tab
            }
        }

        // ========== STUDENT REGISTRATION FUNCTIONS ==========
        function showActionCards() { hideAllForms(); document.getElementById('actionCards').style.display = 'grid'; currentView = 'cards'; }
        function showAddStudentForm() { hideAllForms(); document.getElementById('addStudentForm').style.display = 'block'; currentAction = 'add'; document.getElementById('submitBtn').textContent = 'Save Student'; resetForm(); }
        function showSearchForm() { hideAllForms(); document.getElementById('searchForm').style.display = 'block'; currentView = 'search'; }
        function showAllStudents() { hideAllForms(); document.getElementById('studentsTable').style.display = 'block'; loadStudents(); currentView = 'table'; }
        function hideAllForms() {
            document.getElementById('addStudentForm').style.display = 'none';
            document.getElementById('searchForm').style.display = 'none';
            document.getElementById('searchResults').style.display = 'none';
            document.getElementById('studentsTable').style.display = 'none';
            document.getElementById('actionCards').style.display = 'grid';
            currentView = 'cards';
        }
        function hideSearchResults() { document.getElementById('searchResults').style.display = 'none'; document.getElementById('searchForm').style.display = 'block'; }
        function resetForm() { document.getElementById('studentForm').reset(); document.getElementById('student_id').value = ''; }
        function resetSearchForm() { document.getElementById('searchStudentId').value = ''; document.getElementById('searchFirstName').value = ''; document.getElementById('searchLastName').value = ''; document.getElementById('searchGradeLevel').value = ''; }

        function showEditForm(student) {
            hideAllForms();
            document.getElementById('addStudentForm').style.display = 'block';
            currentAction = 'edit';
            document.getElementById('submitBtn').textContent = 'Update Student';
            document.getElementById('student_id').value = student.student_id || '';
            document.getElementById('first_name').value = student.first_name || '';
            document.getElementById('last_name').value = student.last_name || '';
            document.getElementById('dob').value = student.dob || '';
            document.getElementById('gender').value = student.gender || '';
            document.getElementById('email').value = student.email || '';
            document.getElementById('phone').value = student.phone || '';
            document.getElementById('grade_level').value = student.grade_level || '';
            document.getElementById('section').value = student.section || '';
            document.getElementById('address').value = student.address || '';
            document.getElementById('parent_name').value = student.parent_name || '';
            document.getElementById('parent_phone').value = student.parent_phone || '';
            document.getElementById('registration_status').value = student.registration_status || 'Active';
        }

        async function handleSubmit(event) {
            event.preventDefault();
            const formData = {
                student_id: document.getElementById('student_id').value,
                first_name: document.getElementById('first_name').value,
                last_name: document.getElementById('last_name').value,
                dob: document.getElementById('dob').value,
                gender: document.getElementById('gender').value,
                grade_level: document.getElementById('grade_level').value,
                section: document.getElementById('section').value,
                email: document.getElementById('email').value,
                phone: document.getElementById('phone').value,
                address: document.getElementById('address').value,
                parent_name: document.getElementById('parent_name').value,
                parent_phone: document.getElementById('parent_phone').value,
                registration_status: document.getElementById('registration_status').value
            };
            const url = currentAction === 'add' ? 'StudentAddServlet' : 'StudentUpdateServlet';
            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                    body: new URLSearchParams(formData)
                });
                const result = await response.text();
                if (response.ok) {
                    showNotification(currentAction === 'add' ? 'Student added!' : 'Student updated!', 'success');
                    if (currentAction === 'add') resetForm();
                    if (currentView === 'table') loadStudents();
                    updateDashboardCounts();
                } else {
                    showNotification('Error: ' + result, 'error');
                }
            } catch (error) {
                showNotification('Error: ' + error.message, 'error');
            }
        }

        async function loadStudents() {
            showLoading(true);
            try {
                const response = await fetch('StudentSearchServlet');
                const html = await response.text();
                document.getElementById('studentsTableBody').innerHTML = html;
                document.getElementById('tableContainer').style.display = 'block';
                document.getElementById('noResults').style.display = 'none';
            } catch (error) {
                document.getElementById('studentsTableBody').innerHTML = `<tr><td colspan="7" class="error">Error loading students</td></tr>`;
            } finally { showLoading(false); }
        }

        async function searchStudents() {
            const params = {
                studentId: document.getElementById('searchStudentId').value,
                firstName: document.getElementById('searchFirstName').value,
                lastName: document.getElementById('searchLastName').value,
                gradeLevel: document.getElementById('searchGradeLevel').value
            };
            let url = 'StudentSearchServlet?';
            const parts = [];
            for (let [k, v] of Object.entries(params)) if (v) parts.push(k + '=' + encodeURIComponent(v));
            url += parts.join('&');
            showSearchLoading(true);
            try {
                const response = await fetch(url);
                const html = await response.text();
                document.getElementById('searchForm').style.display = 'none';
                document.getElementById('searchResults').style.display = 'block';
                document.getElementById('searchResultsBody').innerHTML = html;
            } catch (error) {
                document.getElementById('searchResultsBody').innerHTML = '<tr><td colspan="7" class="error">Search failed</td></tr>';
            } finally { showSearchLoading(false); }
        }

        async function deleteStudent(studentId) {
            if (!confirm('Delete this student?')) return;
            try {
                const response = await fetch('StudentDeleteServlet', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                    body: new URLSearchParams({ studentId })
                });
                if (response.ok) {
                    showNotification('Student deleted', 'success');
                    if (currentView === 'table') loadStudents();
                    updateDashboardCounts();
                } else {
                    showNotification('Delete failed', 'error');
                }
            } catch (error) {
                showNotification('Error: ' + error.message, 'error');
            }
        }

        function showLoading(show) {
            document.getElementById('tableLoading').style.display = show ? 'block' : 'none';
            if (show) { document.getElementById('tableContainer').style.display = 'none'; document.getElementById('noResults').style.display = 'none'; }
        }
        function showSearchLoading(show) {
            document.getElementById('searchLoading').style.display = show ? 'block' : 'none';
            if (show) document.getElementById('searchResultsBody').innerHTML = '';
        }

        async function updateDashboardCounts() {
            try {
                const response = await fetch('StudentSearchServlet');
                const html = await response.text();
                const count = (html.match(/<tr>/g) || []).length;
                document.getElementById('totalStudents').textContent = count;
                document.getElementById('newAdmissions').textContent = Math.floor(count * 0.1);
                document.getElementById('pendingRequests').textContent = Math.floor(count * 0.02);
                document.getElementById('todayEnrollments').textContent = Math.floor(count * 0.01);
            } catch (e) {}
        }

        // ========== ENROLLMENT FUNCTIONS ==========
        async function previewPromotion() {
            const fromGrade = document.getElementById('fromGrade').value;
            const toGrade = document.getElementById('toGrade').value;
            const academicYear = document.getElementById('promotionYear').value;
            const newSection = document.getElementById('newSection').value;

            if (!fromGrade || !toGrade || !academicYear) {
                showNotification('Please select all required fields', 'error');
                return;
            }

            document.getElementById('promotionForm').style.display = 'none';
            document.getElementById('promotionPreview').style.display = 'block';
            document.getElementById('previewLoading').style.display = 'block';
            document.getElementById('previewResults').innerHTML = '';

            const params = new URLSearchParams({ fromGrade, toGrade, academicYear, newSection });

            try {
                const response = await fetch('PromotionPreviewServlet?' + params.toString());
                const html = await response.text();
                document.getElementById('previewResults').innerHTML = html;
            } catch (error) {
                document.getElementById('previewResults').innerHTML = '<p class="error">Failed to load preview.</p>';
            } finally {
                document.getElementById('previewLoading').style.display = 'none';
            }
        }

        async function confirmPromotion() {
            if (!confirm('Are you sure you want to promote the eligible students?')) return;

            const fromGrade = document.getElementById('fromGrade').value;
            const toGrade = document.getElementById('toGrade').value;
            const academicYear = document.getElementById('promotionYear').value;
            const newSection = document.getElementById('newSection').value;

            const params = new URLSearchParams({ fromGrade, toGrade, academicYear, newSection });

            try {
                const response = await fetch('PromotionServlet', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                    body: params.toString()
                });
                const result = await response.text();
                if (response.ok) {
                    showNotification('Promotion completed: ' + result, 'success');
                    resetPromotionPreview();
                    hideAllEnrollmentForms();
                } else {
                    showNotification('Error: ' + result, 'error');
                }
            } catch (error) {
                showNotification('Error: ' + error.message, 'error');
            }
        }

        function resetPromotionPreview() {
            document.getElementById('promotionForm').style.display = 'block';
            document.getElementById('promotionPreview').style.display = 'none';
            document.getElementById('previewResults').innerHTML = '';
        }

        function showAddEnrollmentForm() {
            hideAllEnrollmentForms();
            document.getElementById('addEnrollmentForm').style.display = 'block';
            enrollmentCurrentAction = 'add';
            document.getElementById('enrollmentSubmitBtn').textContent = 'Save Enrollment';
            resetEnrollmentForm();
        }

        function showSearchEnrollmentForm() {
            hideAllEnrollmentForms();
            document.getElementById('searchEnrollmentForm').style.display = 'block';
            enrollmentCurrentView = 'search';
        }

        function showBatchPromotionForm() {
            hideAllEnrollmentForms();
            document.getElementById('batchPromotionForm').style.display = 'block';
            enrollmentCurrentView = 'promotion';
        }

        function showAllEnrollments() {
            hideAllEnrollmentForms();
            document.getElementById('allEnrollmentsTable').style.display = 'block';
            loadAllEnrollments();
            enrollmentCurrentView = 'table';
        }

        function hideAllEnrollmentForms() {
            document.getElementById('addEnrollmentForm').style.display = 'none';
            document.getElementById('searchEnrollmentForm').style.display = 'none';
            document.getElementById('batchPromotionForm').style.display = 'none';
            document.getElementById('enrollmentSearchResults').style.display = 'none';
            document.getElementById('allEnrollmentsTable').style.display = 'none';
            document.getElementById('enrollmentActionCards').style.display = 'grid';
            enrollmentCurrentView = 'cards';
        }

        function hideSearchEnrollmentResults() {
            document.getElementById('enrollmentSearchResults').style.display = 'none';
            document.getElementById('searchEnrollmentForm').style.display = 'block';
        }

        function resetEnrollmentForm() {
            document.getElementById('enrollmentForm').reset();
            document.getElementById('enrollment_id').value = '';
            document.getElementById('enrollment_date').value = new Date().toISOString().split('T')[0];
        }

        function resetSearchEnrollmentForm() {
            document.getElementById('searchEnrollStudentId').value = '';
            document.getElementById('searchEnrollGrade').value = '';
            document.getElementById('searchEnrollYear').value = '';
            document.getElementById('searchEnrollStatus').value = '';
        }

        async function loadAcademicYears() {
            try {
                const response = await fetch('AcademicYearServlet');
                const html = await response.text();
                const selects = document.querySelectorAll('#academic_year, #searchEnrollYear, #promotionYear');
                selects.forEach(select => {
                    select.innerHTML = '<option value="">Select Year</option>' + html;
                });
            } catch (e) {
                console.error('Failed to load academic years', e);
            }
        }

        async function loadStudentsForDropdown() {
            try {
                const response = await fetch('StudentListServlet');
                const html = await response.text();
                document.getElementById('student_id').innerHTML = '<option value="">Select Student</option>' + html;
            } catch (e) {
                console.error('Failed to load students', e);
            }
        }

        async function handleEnrollmentSubmit(event) {
            event.preventDefault();
            const formData = {
                enrollment_id: document.getElementById('enrollment_id').value,
                student_id: document.getElementById('student_id').value,
                academic_year: document.getElementById('academic_year').value,
                grade_level: document.getElementById('grade_level').value,
                section: document.getElementById('section').value,
                enrollment_type: document.getElementById('enrollment_type').value,
                enrollment_date: document.getElementById('enrollment_date').value,
                status: document.getElementById('status').value
            };
            const url = enrollmentCurrentAction === 'add' ? 'EnrollmentAddServlet' : 'EnrollmentUpdateServlet';
            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                    body: new URLSearchParams(formData)
                });
                const result = await response.text();
                if (response.ok) {
                    showNotification(enrollmentCurrentAction === 'add' ? 'Enrollment added!' : 'Enrollment updated!', 'success');
                    if (enrollmentCurrentAction === 'add') resetEnrollmentForm();
                    if (enrollmentCurrentView === 'table') loadAllEnrollments();
                } else {
                    showNotification('Error: ' + result, 'error');
                }
            } catch (error) {
                showNotification('Error: ' + error.message, 'error');
            }
        }

        async function searchEnrollments() {
            const params = {
                studentId: document.getElementById('searchEnrollStudentId').value,
                grade: document.getElementById('searchEnrollGrade').value,
                academicYear: document.getElementById('searchEnrollYear').value,
                status: document.getElementById('searchEnrollStatus').value
            };
            let url = 'EnrollmentSearchServlet?';
            const parts = [];
            for (let [k, v] of Object.entries(params)) if (v) parts.push(k + '=' + encodeURIComponent(v));
            url += parts.join('&');
            showEnrollmentSearchLoading(true);
            try {
                const response = await fetch(url);
                const html = await response.text();
                document.getElementById('searchEnrollmentForm').style.display = 'none';
                document.getElementById('enrollmentSearchResults').style.display = 'block';
                document.getElementById('enrollmentSearchBody').innerHTML = html;
            } catch (error) {
                document.getElementById('enrollmentSearchBody').innerHTML = '<tr><td colspan="10" class="error">Search failed</td></tr>';
            } finally {
                showEnrollmentSearchLoading(false);
            }
        }

        async function loadAllEnrollments() {
            showAllEnrollmentsLoading(true);
            try {
                const response = await fetch('EnrollmentSearchServlet');
                const html = await response.text();
                document.getElementById('allEnrollmentsBody').innerHTML = html;
                document.getElementById('allEnrollmentsContainer').style.display = 'block';
                document.getElementById('noEnrollments').style.display = 'none';
            } catch (error) {
                document.getElementById('allEnrollmentsBody').innerHTML = '<tr><td colspan="10" class="error">Error loading enrollments</td></tr>';
            } finally {
                showAllEnrollmentsLoading(false);
            }
        }

        function showEditEnrollment(enrollment) {
            hideAllEnrollmentForms();
            document.getElementById('addEnrollmentForm').style.display = 'block';
            enrollmentCurrentAction = 'edit';
            document.getElementById('enrollmentSubmitBtn').textContent = 'Update Enrollment';
            document.getElementById('enrollment_id').value = enrollment.enrollment_id || '';
            document.getElementById('student_id').value = enrollment.student_id || '';
            document.getElementById('academic_year').value = enrollment.academic_year || '';
            document.getElementById('grade_level').value = enrollment.grade_level || '';
            document.getElementById('section').value = enrollment.section || '';
            document.getElementById('enrollment_type').value = enrollment.enrollment_type || '';
            document.getElementById('enrollment_date').value = enrollment.enrollment_date || '';
            document.getElementById('status').value = enrollment.status || '';
        }

        async function deleteEnrollment(enrollmentId) {
            if (!confirm('Delete this enrollment?')) return;
            try {
                const response = await fetch('EnrollmentDeleteServlet', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                    body: new URLSearchParams({ enrollmentId })
                });
                if (response.ok) {
                    showNotification('Enrollment deleted', 'success');
                    if (enrollmentCurrentView === 'table') loadAllEnrollments();
                } else {
                    showNotification('Delete failed', 'error');
                }
            } catch (error) {
                showNotification('Error: ' + error.message, 'error');
            }
        }

        async function handlePromotionSubmit(event) {
            event.preventDefault();
            const formData = {
                fromGrade: document.getElementById('fromGrade').value,
                toGrade: document.getElementById('toGrade').value,
                academicYear: document.getElementById('promotionYear').value,
                newSection: document.getElementById('newSection').value
            };
            try {
                const response = await fetch('PromotionServlet', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                    body: new URLSearchParams(formData)
                });
                const result = await response.text();
                if (response.ok) {
                    showNotification('Promotion completed! ' + result, 'success');
                    hideAllEnrollmentForms();
                } else {
                    showNotification('Error: ' + result, 'error');
                }
            } catch (error) {
                showNotification('Error: ' + error.message, 'error');
            }
        }

        function showEnrollmentSearchLoading(show) {
            document.getElementById('enrollmentSearchLoading').style.display = show ? 'block' : 'none';
            if (show) document.getElementById('enrollmentSearchBody').innerHTML = '';
        }
        function showAllEnrollmentsLoading(show) {
            document.getElementById('allEnrollmentsLoading').style.display = show ? 'block' : 'none';
            if (show) {
                document.getElementById('allEnrollmentsContainer').style.display = 'none';
                document.getElementById('noEnrollments').style.display = 'none';
            }
        }

        // ========== CERTIFICATE FUNCTIONS ==========
        function showCertificateSearch(type) {
            currentCertType = type;
            let displayName = '';
            if (type === 'enrollment') displayName = 'Enrollment Certificate';
            else if (type === 'completion') displayName = 'Completion Certificate';
            else if (type === 'transcript') displayName = 'Academic Transcript';
            document.getElementById('selectedCertTypeDisplay').innerText = displayName;
            document.getElementById('certificateSearchSection').classList.add('active');
            // Clear previous results
            document.getElementById('certStudentResults').innerHTML = '';
        }

        function hideCertificateSearch() {
            document.getElementById('certificateSearchSection').classList.remove('active');
            resetCertificateSearch();
        }

        function resetCertificateSearch() {
            document.getElementById('certSearchStudentId').value = '';
            document.getElementById('certSearchFirstName').value = '';
            document.getElementById('certSearchLastName').value = '';
            document.getElementById('certSearchGradeLevel').value = '';
            document.getElementById('certStudentResults').innerHTML = '';
        }

        async function searchCertificateStudents() {
            const params = {
                studentId: document.getElementById('certSearchStudentId').value,
                firstName: document.getElementById('certSearchFirstName').value,
                lastName: document.getElementById('certSearchLastName').value,
                gradeLevel: document.getElementById('certSearchGradeLevel').value
            };
            let url = 'CertificateServlet?type=search&';
            const parts = [];
            for (let [k, v] of Object.entries(params)) if (v) parts.push(k + '=' + encodeURIComponent(v));
            url += parts.join('&');
            try {
                const response = await fetch(url);
                const html = await response.text();
                document.getElementById('certStudentResults').innerHTML = html;
            } catch (error) {
                document.getElementById('certStudentResults').innerHTML = '<p class="error">Search failed.</p>';
            }
        }

        function generateCertificate(studentId) {
            if (!studentId) return;
            window.location.href = 'CertificateServlet?type=' + currentCertType + '&studentId=' + studentId;
        }

        // ========== INITIALIZATION ==========
        document.addEventListener('DOMContentLoaded', function() {
            showSection('dashboard');
            document.getElementById('dob').max = new Date().toISOString().split('T')[0];
        });
    </script>
</body>
</html>